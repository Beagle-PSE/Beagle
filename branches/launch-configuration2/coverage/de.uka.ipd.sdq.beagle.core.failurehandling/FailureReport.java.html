<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>FailureReport.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Core</a> &gt; <a href="index.source.html" class="el_package">de.uka.ipd.sdq.beagle.core.failurehandling</a> &gt; <span class="el_source">FailureReport.java</span></div><h1>FailureReport.java</h1><pre class="source lang-java linenums">package de.uka.ipd.sdq.beagle.core.failurehandling;

import org.apache.commons.lang3.Validate;
import org.apache.commons.lang3.exception.ExceptionUtils;

import java.util.function.Supplier;

/**
 * Information about a failure that occurred while running Beagle. Besides a message and
 * information about the causing (or indicating) exception, a failure report may continue
 * information on how to recover from a failure. The failure reported through this report
 * is considered non-recoverable until a recover function has be set through
 * {@link #recoverable()}, {@link #retryWith} or {@link #continueWith}.
 *
 * @author Joshua Gleitze
 *
 * @param &lt;RECOVER_TYPE&gt; The return type of the recover functions.
 */
<span class="fc" id="L19">public class FailureReport&lt;RECOVER_TYPE&gt; {</span>

	/**
	 * Message giving information about the failure.
	 */
	private String failureMessage;

	/**
	 * Details about the failure.
	 */
<span class="fc" id="L29">	private final StringBuilder failureDetails = new StringBuilder();</span>

	/**
	 * Wheter details about the failure have yet been provided.
	 */
	private boolean detailsProvided;

	/**
	 * Exception that caused or indicated the failure.
	 */
	private Exception failureCause;

	/**
	 * A routine to call if it is wished to continue by ignoring the failure.
	 */
	private Supplier&lt;RECOVER_TYPE&gt; continueFunction;

	/**
	 * A routine to call if it is wished to retry the action the failure occurred at.
	 */
	private Supplier&lt;RECOVER_TYPE&gt; retryFunction;

	/**
	 * Supplies a message describing the failure. The message will be evaluated through
	 * {@link String#format(String, Object...)}.
	 *
	 * @param message A message describing the failure. Must not be {@code null}.
	 * @param values Format values, will be passed to
	 *            {@link String#format(String, Object...)}.
	 * @return {@code this}.
	 */
	public FailureReport&lt;RECOVER_TYPE&gt; message(final String message, final Object... values) {
<span class="fc" id="L61">		Validate.notNull(message);</span>
<span class="fc" id="L62">		this.failureMessage = String.format(message, values);</span>
<span class="fc" id="L63">		return this;</span>
	}

	/**
	 * Supplies a message giving details about the failure. The message will be evaluated
	 * through {@link String#format(String, Object...)} and be &lt;em&gt;perepended&lt;/em&gt; to
	 * potentally already existing details.
	 *
	 * @param message Details about the reported failure.
	 * @param values Format values, will be passed to
	 *            {@link String#format(String, Object...)}.
	 * @return {@code this}.
	 */
	public FailureReport&lt;RECOVER_TYPE&gt; details(final String message, final Object... values) {
<span class="fc" id="L77">		this.detailsProvided = true;</span>
<span class="fc" id="L78">		this.failureDetails.insert(0, String.format(message, values));</span>
<span class="fc" id="L79">		return this;</span>
	}

	/**
	 * Supplies the exception that caused or indicated the failure. If no message has been
	 * set on this report yet, the report’s message will be set to
	 * {@code cause.getMessage()}. The exception’s stacktrace will be appnended to the
	 * report’s {@linkplain #details(String, Object...) details}. A new report’s cause is
	 * {@code null}.
	 *
	 * @param cause The exception that caused or indicated the failure. Must not be
	 *            {@code null}.
	 * @return {@code this}.
	 */
	public FailureReport&lt;RECOVER_TYPE&gt; cause(final Exception cause) {
<span class="fc" id="L94">		Validate.notNull(cause);</span>

<span class="fc" id="L96">		this.failureCause = cause;</span>
<span class="fc bfc" id="L97" title="All 2 branches covered.">		if (this.failureMessage == null) {</span>
<span class="fc" id="L98">			this.failureMessage = cause.getMessage();</span>
		}
<span class="fc" id="L100">		this.detailsProvided = true;</span>
<span class="fc" id="L101">		this.failureDetails.append(ExceptionUtils.getStackTrace(cause));</span>
<span class="fc" id="L102">		return this;</span>
	}

	/**
	 * Reports that the failure is recoverable by continuing the normal control flow after
	 * the failure handling. The failure reporter will receive {@code null} as the result
	 * of handling this report.
	 *
	 * @return {@code this}.
	 */
	public FailureReport&lt;RECOVER_TYPE&gt; recoverable() {
<span class="fc" id="L113">		this.continueFunction = () -&gt; {</span>
			return null;
		};
<span class="fc" id="L116">		return this;</span>
	}

	/**
	 * Reports that the failure is recoverable by continuing by running {@code continueAt}
	 * .
	 *
	 * @param continueAt A function defining how to continue while skipping the failed
	 *            action. Supplies the value the failure reporter should use instead of
	 *            the one that was expected to be generated skipped action.
	 * @return {@code this}.
	 */
	public FailureReport&lt;RECOVER_TYPE&gt; continueWith(final Supplier&lt;RECOVER_TYPE&gt; continueAt) {
<span class="fc" id="L129">		this.continueFunction = continueAt;</span>
<span class="fc" id="L130">		return this;</span>
	}

	/**
	 * Reports that the failure is recoverable by continuing by running {@code continueAt}
	 * . The failure reporter will receive {@code null} as the result of handling this
	 * report.
	 *
	 * @param continueAt A runnable defining how to continue while skipping the failed
	 *            action.
	 * @return {@code this}.
	 */
	public FailureReport&lt;RECOVER_TYPE&gt; continueWith(final Runnable continueAt) {
<span class="fc" id="L143">		this.continueFunction = () -&gt; {</span>
			continueAt.run();
			return null;
		};
<span class="fc" id="L147">		return this;</span>
	}

	/**
	 * Reports that the failure is recoverable by retrying the failed action by running
	 * {@code retryAt}.
	 *
	 * @param retryAt A function defining how to retry the failed action. Supplies the
	 *            value the reporter should use instead of the one that was expected to be
	 *            generated by the failed action.
	 * @return {@code this}.
	 */
	public FailureReport&lt;RECOVER_TYPE&gt; retryWith(final Supplier&lt;RECOVER_TYPE&gt; retryAt) {
<span class="fc" id="L160">		this.retryFunction = retryAt;</span>
<span class="fc" id="L161">		return this;</span>
	}

	/**
	 * Reports that the failure is recoverable by retrying the failed action by running
	 * {@code retryAt}. The failure reporter will receive {@code null} as the result of
	 * handling this report.
	 *
	 * @param retryAt A runnable defining how to retry the failed action.
	 * @return {@code this}.
	 */
	public FailureReport&lt;RECOVER_TYPE&gt; retryWith(final Runnable retryAt) {
<span class="fc" id="L173">		this.retryFunction = () -&gt; {</span>
			retryAt.run();
			return null;
		};
<span class="fc" id="L177">		return this;</span>
	}

	/**
	 * Gets the report’s failure description.
	 *
	 * @return A description of the failure. {@code null} indicates that there’s no
	 *         information available.
	 *
	 * @see #message(String, Object...)
	 */
	public String getFailureMessage() {
<span class="fc" id="L189">		return this.failureMessage;</span>
	}

	/**
	 * Gets the report’s failure details.
	 *
	 * @return Details about the failure. {@code null} indicates that there’s no
	 *         information available.
	 *
	 * @see #details(String, Object...)
	 */
	public String getDetails() {
<span class="fc bfc" id="L201" title="All 2 branches covered.">		return (this.detailsProvided) ? this.failureDetails.toString() : null;</span>
	}

	/**
	 * Gets the exception that caused or indicated the reported failure.
	 *
	 * @return The causing exception. {@code null} indicates that the reported failure was
	 *         not caused by an exception.
	 *
	 * @see #cause(Exception)
	 */
	public Exception getFailureCause() {
<span class="fc" id="L213">		return this.failureCause;</span>
	}

	/**
	 * Gets the function that lets Beagle continue the analysis by skipping the failed
	 * action.
	 *
	 * @return The function detailing how to continue. {@code null} indicates that Beagle
	 *         cannot continue without the failed action.
	 *
	 * @see #recoverable()
	 * @see #continueWith(Runnable)
	 */
	public Supplier&lt;RECOVER_TYPE&gt; getContinueRoutine() {
<span class="fc" id="L227">		return this.continueFunction;</span>
	}

	/**
	 * Gets the function that lets Beagle retry the failed failed action.
	 *
	 * @return The function detailing how to retry the failed action. {@code null}
	 *         indicates that the failed action cannot be retried.
	 *
	 * @see #retryWith(Runnable)
	 */
	public Supplier&lt;RECOVER_TYPE&gt; getRetryRoutine() {
<span class="fc" id="L239">		return this.retryFunction;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.1.201405082137</span></div></body></html>