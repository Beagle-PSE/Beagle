<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>PcmNameParser.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Core</a> &gt; <a href="index.source.html" class="el_package">de.uka.ipd.sdq.beagle.core.pcmconnection</a> &gt; <span class="el_source">PcmNameParser.java</span></div><h1>PcmNameParser.java</h1><pre class="source lang-java linenums">package de.uka.ipd.sdq.beagle.core.pcmconnection;

import de.uka.ipd.sdq.beagle.core.CodeSection;

import java.io.File;
import java.io.FileNotFoundException;

/**
 * This parser is a draft that can only provide proper functionality if SoMoX does not
 * change its naming convention for EntityNames. It offers one method
 * {@link PcmNameParser#parse} to read out the {@link CodeSection CodeSections} in a given
 * String. Attention! This Parser can not read out as much as desired for the
 * {@link CodeSection}. For more information, read through the java-doc of the method
 * {@link parse}.
 * 
 * @author Ansgar Spiegler
 *
 */
<span class="nc" id="L19">public class PcmNameParser {</span>

	/**
	 * &quot;@position: &quot; annotation in the entity name.
	 */
	private static final String AT_POSITION_COLON_SPACE = &quot;@position: &quot;;

	/**
	 * &quot;DOTjava&quot; annotation in the entity name.
	 */
	private static final String DOT_JAVA = &quot;.java&quot;;

	/**
	 * &quot; from &quot; annotation in the entity name.
	 */
	private static final String SPACE_FROM_SPACE = &quot; from &quot;;

	/**
	 * &quot; to &quot; annotation in the entity name.
	 */
	private static final String SPACE_TO_SPACE = &quot; to &quot;;

	/**
	 * &quot; at &quot; annotation in the entity name.
	 */
	private static final String SPACE_AT_SPACE = &quot; at &quot;;

	/**
	 * The {@link CodeSection} that should be created.
	 */
	private CodeSection codeSection;

	/**
	 * The position of &quot; from &quot; in the given String.
	 */
	private int fromOffset;

	/**
	 * The position of &quot; to &quot; in the given String.
	 */
	private int toOffset;

	/**
	 * The position of &quot; at &quot; in the given String.
	 */
	private int atOffset;

	/**
	 * The file that is created by the relative path between &quot;@position: &quot; and &quot;.java&quot;.
	 */
	private File file;

	/**
	 * The from-Position marking the sourceCode.
	 */
	private int fromPos;

	/**
	 * The to-Position marking the sourceCode.
	 */
	private int toPos;

	/**
	 * The at-Position marking the sourceCode.
	 */
	private int atPos;

	/**
	 * Parsing a SoMoX-created String to get the annotated CodeSection.
	 * 
	 * @param entityName SoMoX generated entityName. If not, this leads to undefined
	 *            behaviour.
	 * @return May return &lt;li&gt; {@code null}, if the String contains no file-path &lt;/li&gt;
	 *         &lt;li&gt; {@link CodeSection}. Initialized with (file, firstOffset, file,
	 *         secondOffset) OR (file, firstOffset, file, -1) if there is no second Offset
	 *         available. Anyway, the first &quot;file&quot; and the second &quot;file&quot; are the same!
	 * @throws FileNotFoundException When the file was not found at the given relative
	 *             path.
	 */
	public CodeSection parse(final String entityName) throws FileNotFoundException {

<span class="nc" id="L100">		this.reset();</span>
<span class="nc" id="L101">		this.loadFile(entityName);</span>
<span class="nc bnc" id="L102" title="All 2 branches missed.">		if (this.file == null) {</span>
<span class="nc" id="L103">			return null;</span>
		}

<span class="nc" id="L106">		this.fromPos = entityName.indexOf(PcmNameParser.SPACE_FROM_SPACE);</span>
<span class="nc" id="L107">		this.toPos = entityName.indexOf(PcmNameParser.SPACE_TO_SPACE);</span>
<span class="nc bnc" id="L108" title="All 4 branches missed.">		if (this.fromPos != -1 &amp;&amp; this.toPos != -1) {</span>

<span class="nc" id="L110">			this.fromOffset = Integer</span>
<span class="nc" id="L111">				.parseInt(entityName.substring(this.fromPos + PcmNameParser.SPACE_FROM_SPACE.length(), this.toPos));</span>
<span class="nc" id="L112">			this.toOffset = Integer.parseInt(</span>
<span class="nc" id="L113">				entityName.substring(this.toPos + PcmNameParser.SPACE_TO_SPACE.length(), entityName.length()));</span>

<span class="nc" id="L115">			this.codeSection = new CodeSection(this.file, this.fromOffset, this.file, this.toOffset);</span>

		} else {
<span class="nc" id="L118">			this.atPos = entityName.indexOf(PcmNameParser.SPACE_AT_SPACE);</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">			if (this.atPos != -1) {</span>
<span class="nc" id="L120">				this.atOffset = Integer.parseInt(</span>
<span class="nc" id="L121">					entityName.substring(this.atPos + PcmNameParser.SPACE_AT_SPACE.length(), entityName.length()));</span>

<span class="nc" id="L123">				this.codeSection = new CodeSection(this.file, this.atOffset, this.file, -1);</span>
			}
		}

<span class="nc" id="L127">		return this.codeSection;</span>

	}

	/**
	 * Tries to load the file, looking at the given substring between &quot;@position: &quot; and
	 * &quot;.java&quot;. May set {@link file} to null if no file annotation was found. Otherwise
	 * {@line file} is set to the .java file at the given position.
	 * 
	 * @param entityName The full entityName.
	 * 
	 * @throws FileNotFoundException Tries to load a file at the given path. If no valid
	 *             file can be loaded at a given position, this exception is thrown.
	 */
	private void loadFile(final String entityName) throws FileNotFoundException {
		String fileName;
<span class="nc" id="L143">		final int position = entityName.indexOf(PcmNameParser.AT_POSITION_COLON_SPACE);</span>
<span class="nc" id="L144">		final int blockPos = entityName.indexOf(PcmNameParser.DOT_JAVA);</span>

<span class="nc bnc" id="L146" title="All 4 branches missed.">		if (position != -1 &amp;&amp; blockPos != -1) {</span>
<span class="nc" id="L147">			fileName = entityName.substring(position + PcmNameParser.AT_POSITION_COLON_SPACE.length(), blockPos);</span>
<span class="nc" id="L148">			fileName = fileName.replace(&quot;.&quot;, &quot;/&quot;);</span>
<span class="nc" id="L149">			fileName = fileName.concat(&quot;.java&quot;);</span>
<span class="nc" id="L150">			this.file = new File(fileName);</span>

<span class="nc bnc" id="L152" title="All 2 branches missed.">			if (!this.file.isFile()) {</span>
<span class="nc" id="L153">				throw new FileNotFoundException(&quot;The file \&quot;&quot; + fileName + &quot;\&quot; was not found.&quot;);</span>

			}

		} else {
<span class="nc" id="L158">			this.file = null;</span>
		}
<span class="nc" id="L160">	}</span>

	/**
	 * Reset/initializing step of all storing variables.
	 *
	 */
	private void reset() {
<span class="nc" id="L167">		this.codeSection = null;</span>

<span class="nc" id="L169">		this.fromOffset = -1;</span>
<span class="nc" id="L170">		this.toOffset = -1;</span>
<span class="nc" id="L171">		this.atOffset = -1;</span>
<span class="nc" id="L172">		this.file = null;</span>

<span class="nc" id="L174">		this.fromPos = -1;</span>
<span class="nc" id="L175">		this.toPos = -1;</span>
<span class="nc" id="L176">		this.atPos = -1;</span>
<span class="nc" id="L177">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.1.201405082137</span></div></body></html>